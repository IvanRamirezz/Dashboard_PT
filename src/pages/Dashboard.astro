---
import DashboardLayout from '../layouts/DashboardLayout.astro';
import StatCard from '../components/Home/Statcard.astro';
import '../styles/style.css';
import Alumnos from "../../public/assets/Alumnos.png";
import asignar_practica from "../../public/assets/formacion.png";

import { requireProfessor } from "../lib/authGuard";
import { supabase } from "../lib/supabase";

// üîê SOLO PROFESORES
const authResult = await requireProfessor(Astro);

if (authResult instanceof Response) {
  return authResult;
}

const user = authResult.user;

// Traer nombre del profesor
const authUid = user.id;

let nombreCompleto = user.email;

const { data: usuario } = await supabase
  .from("Usuarios")
  .select("Nombre, Apellido_Paterno")
  .eq("auth_uid", authUid)
  .maybeSingle();

if (usuario) {
  nombreCompleto = `${usuario.Nombre} ${usuario.Apellido_Paterno}`;
}
---

<DashboardLayout pageTitle="Dashboard">
  <section class="content">
    <h1 class="text-2xl font-semibold mb-4">
      Bienvenido, {nombreCompleto}
    </h1>

    <div class="stats">
      <StatCard type="grupos" label="Grupos registrados" />
      <StatCard type="practicas" label="Pr√°cticas activas" />
      <StatCard type="alumnos" label="Alumnos inscritos" />
    </div>

    <div class="actions">
      <a href="/Alumnos" class="action">
        <div>
          <img src={Alumnos.src} class="icon" alt="" />
          Informaci√≥n Alumnos
        </div>
        <span>‚Üí</span>
      </a>

      <a href="/Asignar" class="action">
        <div>
          <img src={asignar_practica.src} class="icon" alt="" />
          Asignar pr√°ctica
        </div>
        <span>‚Üí</span>
      </a>
    </div>
  </section>
</DashboardLayout>
